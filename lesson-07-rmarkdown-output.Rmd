# Lesson 7 - RMarkdown - Output formats {#rmarkdownoutput}
```{r setuples, include=FALSE}
les <- 7
```

_This chapter is best read in the source RMarkdown file_


## There are multiple RMarkdown outputs

 - pdf
 - MS Office Word
 - MS Office Powerpoint
 - Slide shows (`ioslides_presention`, `beamer`)



## output formats

### Possibilities

With Rmarkdown you can generate many different things. This reader was made in Rmarkdown. The DAUR1 capstone pdf? RMarkdown. The latest report Alyanne had to send to an ethical committee? Again RMarkdown. Every time we send you all very similar but slightly different emails with stuff like your server password? We generate those using Rmarkdown.

These websites are examples too: [click](https://rmarkdown.rstudio.com/flexdashboard/), [click](https://www.r-graph-gallery.com/index.html).

Have a look around on the following website to get a feeling for what is possible with Rmarkdown.

- [https://r-markdown-gallery.com/index.html](https://r-markdown-gallery.com/index.html)
- [https://bookdown.org/yihui/rmarkdown/basics-examples.html](https://bookdown.org/yihui/rmarkdown/basics-examples.html)

### Setting output format

You can specifically choose which output format to render to with the RStudio "Knit" button in the toolbar, or with:

```
rmarkdown::render(...)
```

We can control which output format(s) knitting will produce and even customize the options for each format separately.
To customize each output format, change the YAML frontmatter:
(toc is the table of contents)

```
---
title: "My document"
output:
  html_document:
    toc: true
    toc_float: true
---
```

e.g. customize HTML and PDF output both:

```
---
title: "My document"
output:
  html_document:
    toc: true
    toc_float: true
  pdf_document:
    fig_caption: false
---
```

<div class="question">

##### Exercise `r les`

[exercise from r4ds here](https://r4ds.had.co.nz/r-markdown.html#exercises-71)

Create one new R Markdown document for each of the three built-in formats: HTML, PDF and Word. Knit each of the three example documents. How does the output differ? How does the input differ? (You may need to install LaTeX in order to build the PDF output â€” RStudio will prompt you if this is necessary.)
</div>
 
 
## LaTeX installation 



## Interactivity {#rmarkdowninteractive}


## Aim of this lesson

This lesson is about building Shiny apps to create interactive visualizations, apps and dashbords. We will build a small Shiny app and Dashboard to get you started with `{shiny}`. Thirdly, we will also have a look at how to increase interactivity even more by creating interactive visualizations.

## Resources

[`{flexdashboards}`](https://rmarkdown.rstudio.com/flexdashboard/)

[`{shiny}`](https://shiny.rstudio.com/)

[shiny webinars](https://shiny.rstudio.com/tutorial/)

[`{shinydashboard}`](https://rstudio.github.io/shinydashboard/get_started.html)

## Shiny
Adapted from: https://shiny.rstudio.com/tutorial/
Shiny is an R package that makes it easy to build interactive web applications (apps) straight from R. This lesson will get you started building Shiny apps, though a set of simple examples. Than you need to create a new shiny app from covid-19 case data that is supplied by the RIVM and reflects the covid-19 cases on the city level. 

## My first shiny
To get started with shiny you will need the `{shiny}` R package. The shiny package has a number of build-in isolated shiny apps as examples.
```{r, eval=FALSE}
# install.packages("shiny")
library(shiny)
runExample("01_hello")
```
This will show a histogram of the famous 'faithful' dataset in a pop-up window. The slider can be used to generate multiple versions of this histogram with different number of bins.
So a shiny app is in principle a reactive piece of R code that is run from the input the user specifies. 

##### <div class="question">
Exercise 4.5

Go over the following steps to complete this exercise  

 1. Inspect the source code of the build-in shiny package example "01_hello" that we ran above. 
 1. Copy the source code to an R script (call this file `app.R`) that you store in an `app_example_01_hello` folder in your portfolio project.
 1. Try running the `app.R` file from your portfolio project (open a new session in RStudio)
 1. Now examine the source code and try adjusting the number of bins that is diplayed in the app by default, try a number of different settings
 1. Which piece of code regulates this setting? In which part of the app (`ui` or `server`) is this managed?

</div>

### Interactivity 
The responsiveness of an R object inside a shiny app is a core feature of most shiny apps. This means that for example visualizations based on data are immediatly changed if the user packs a different setting in the UI. This reposiveness can be addedd to an app by using the `reactive()` function in the `{shiny}` package. By using a reactive dataframe for example the input data that is used for example for a table of a graph is updated as soon as the user picks a different setting in the app. Using `reactive()` can greatly speed up the performance of an app.   

We can see the `reactive()` function in action in the following example
```{r, eval=FALSE}
runExample("03_reactivity")
```
Look at the app source code to understand what the `reactive()` part of the code does in this case.


##### <div class="question">
Exercise 4.5

Go over the following steps to complete this exercise  

 1. Study the source code of the build in shiny app example called "04_mpg"
 1. Look at the overall app structure, what is the input and output? Explain in your own words
 1. Look at the `reactive()` part of the server code, what does it do?

<details><summary>Click for the answer</summary>
```{r, eval=FALSE}
## to access the example needed for this exercise
library(shiny)
runExample("04_mpg")
```

</details>

##### <div class="question">
Assignment 

Complete the following steps to finish this assingment. Upload the resulting `app.R` file in your portfolio github project.

Go over the shiny _Written_ tutorials lesson 1 to 7: https://shiny.rstudio.com/tutorial/. You will need the information in these lessons to complete this assignment.

These are the steps:

 1. Fork and clone [this Github repo] to your Rstudio environment.
 1. Study the source code of `app.R` file carefully
 1. Study the source code of the `helpers.R` files in the `./app/shiny` folder
 1. Run the app locally, play around with the select input box and see what happens
 1. The app does not display data for the vaccination for some countries and continents, because this data is lacking from the input data. Look around on the internet to see if you can find data that has this information.
 1. How would you incorporate the new data source you found in the previous step? 
 1. If you found a relevant data source: add a piece of code to the app that displays this new data. Update the app.R code 
 1. If you did not find any relevant data to add: rewrite the app so that it displays a notification that "no data on vaccinations is available for the selected country"
 1. As you can see from the code, the current version of the app does not use the `reactive()` function. Rewrite part of the app so that the `reactive()` function is used to generate the input data. 
 1. Once you are done, push your changes to your forked branch of the repo and create a pull request.
 1. Publish your version of the `app.R` (and `helpers.R`) scripts in your portfolio.
 
</div>


### Creating dashboards with shiny
Once you master the basics of shiny, you probably want to be able to build more complicated apps. One way of achieving a more visually appealing app and extend its functionality is by building a dashboard. A dashboard usually has some data input and multiple categories of information displayed from this data input. These categories are usually defined by tabs in the dashboard. To learn more about how to build nice dashboards in R go over [this tutorial:](). You will need this information to complete the second assignment of this lesson. 


##### <div class="question">
Assignment 4.5

For this assignment you need to build and publish a shiny dashboard. You need to use data from your projecticum assignment. We will organize a moment in class where you can show what you build. Because some of the projecticum projects are confidential, we ask you **not to publish** this app somewhere. The demo you will need to give will be done by running the app in a local (or on the Rstudio Server if you want) Rstudio session.   

For this assignment you will have to complete these steps:

 1. If you have not already done so, watch the [video tutorial on shiny](https://shiny.rstudio.com/tutorial/#video-tutorials)
 1. Go over the [`{shinydashboard}` tutorial](https://rstudio.github.io/shinydashboard/get_started.html)
 1. From the `{shinydashboard}` tutorial example build a small dashboard (with at least two tabs), using a dataset of your projecticum.
 1. Prepare for a short demo of your dashboard in the upcoming plenary class discussion. You will need to show your app and explain what it does and how your programmed it that way. 

</div>

### Interactive visualizations
Building a shiny app in which you or someone else can interact with the data ads a lot of interactivity to data. You can enable users to explore and visualize patters in the data and run multiple statistical models, without the need for a user to be able to program in R. Adding interactivity to a plot can also increase the user experience. One of the frameworks that is integrated with shiny is `{ggiraph}`. In our next assignment we will add some `{ggiraph}` elements to the dashboard you created for in the previous assignment.   
The `{ggiraph}` package has a number of build-in examples. Just like the shiny examples you can run them using the `run_girafe_example()` `{ggiraph}` function. To list all examples run

```{r, eval=FALSE}
library(ggiraph)
?run_girafe_example
```

Let's look at a `{ggiraph}` + `{shiny}` example

```{r, eval=FALSE}
run_girafe_example("crimes")
```

In this example you see how a 'normal' gg2plot is transformed into an interactive graph using the `renderGirafe()` function in the `server` part of the shiny app and the `girafeOutput()` function in the `ui` part of the app. Using these examples, you can easily incorporate an interactive `{ggiraph}` object in your own shiny dashboard. This is the aim of the next and final assingment of this lesson.  

##### 
<div class="question">
Assignment 4.5

Go over the following steps to complete this exercise:

 1. Go over the [`{ggiraph}` tutorial here:](https://davidgohel.github.io/ggiraph/articles/offcran/using_ggiraph.html) 
 1. Study the ["Shiny usage" tutorial part here:](https://davidgohel.github.io/ggiraph/articles/offcran/shiny.html)
 1. In the shiny dashboard you created in the previous assignment, add a `{ggiraph}` interactive element to this dashboard
 1. Update the dashboard code and push it to your projecticum github repository
 
 **Th-th-that's all folks!** 


## Setting up a bookdown project and publishing it online as course portfolio {#bookdownportfolio}

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Lesson aim
After this lesson you will be able to

 1. Setup github pages
 1. Create a bookdown project
 1. Render a bookdown project to a local website
 1. Add the rendered site to your github pages
 
## Github pages
Each account on github can be associated to one or multiple websites that are hosted on Github.com. To setup a website on Github (also called `github-pages` or `gh-pages`), we need to create a repository with a special name. For this course we will require you to upload results from the exercises and assignments results to you personal github pages. **This is a hard requirement for passing this course. If you have no or an empty portfolio, you cannot pass this course**

<div class="question">
##### Exercise `r les`

 1. Execute the steps explained [here](https://guides.github.com/features/pages/) to setup a github-pages repository called `workflows-portfolio`
 1. Send the url to your public portfolio address to the teachers by personal chat. 

</div>

## Bookdown
The `{bookdown}` R package is basically a collection of RMarkdown files, collated into a website with nice formatting and the possibility to cross reference and add citations and visualizations. The author of the bookdown is also the main author of `{knitr}`.    

## A simple bookdown example
To start with bookdown, there is a [good and free resource available](https://bookdown.org/yihui/bookdown/get-started.html). 

## Transform your current portfolio project to a bookdown site
By now you should have collected several Rmd files for completing the exercises and assignments in the course thusfar. If everything went well, you have these files collected in your portfolio RStudio project, linked to a Github repo.
To start building your bookdown project, use the minimal example you have seen above. Start by rendering your project using `bookdown::render()`. To the very least you should have an index.html file that contains the yaml definitions for your bookdown project. You can arrange the chapters by using an index in every Rmd file. Use indexes like `001_<file_name>.Rmd`. When you want to add a chapter in between two chapters, this makes it easier. to achieve this.

## Render the book locally
When you have build your `index.Rmd` file and have collected all files in the root of your project, be sure all depending data, scripts and other files such as images etc. are also present in the project. Use the guerrilla analytics logic to setup the project structure. Set the option `new_session: yes` in your `_bookdown.yml` or `index.Rmd` file. This prevent problems down the line. Render the book until all errors are solved. You can debud each file and error by looking at the line numbers where the rendering is causing problems.


## Hosting the bookdown project in your github pages

**IMPORTANT NOTE ON CONFIDENTIALITY**

<mark>**When hosting you portfolio on a public web address, please make sure that there is no confidential information visable in your project. Data that falls under a non-disclosure agreement for example from your projecticum may not be shared. Also, be sure not to publish any personal secrets such as passwords and tokens, inside a github repo or webpage.**</mark> 

Once you have sucefully rendered your bookdown to a full website, hosting can be achived by copying all html files to your Github-pages. The easiest way is to clone your github pages repo and add, commit and push all html files to your github pages repo. The website will be automatically updated after some time. You can also setup a theme for your github pages. See [here](https://docs.github.com/en/github/working-with-github-pages/adding-a-theme-to-your-github-pages-site-with-the-theme-chooser) for more info.

For a complete manual on working with github pages, [see the gh-pages docs](https://docs.github.com/en/github/working-with-github-pages/getting-started-with-github-pages) 

If you want to go for a full continuous integration workflow (which is highly recommended), you can follow these steps in [this blog](https://medium.com/@delucmat/how-to-publish-bookdown-projects-with-github-actions-on-github-pages-6e6aecc7331e)


